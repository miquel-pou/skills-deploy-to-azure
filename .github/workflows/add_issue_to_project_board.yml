name: Learning GitHub Script
on:
  issues:
    types: [opened]
jobs:
  comment:
    runs-on: ubuntu-latest
    steps:
    - name: Comment on new issue
      uses: actions/github-script@0.8.0
      with:
        github-token: ${{secrets.GITHUB_TOKEN}}
        script: |
            github.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: "üéâ You've created this issue comment using GitHub Script!!!"
            })

 # 1Ô∏è‚É£ Obtener ID del proyecto "Test Project"
    - name: Get project ID
      id: get_project
      uses: actions/github-script@0.8.0
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const projectName = 'Test Project';

          const projects = await github.projects.listForRepo({
            owner: context.repo.owner,
            repo: context.repo.repo
          });

          const project = projects.data.find(p => p.name === projectName);
          if (!project) {
            throw new Error(`Proyecto "${projectName}" no encontrado`);
          }

          core.setOutput('project_id', project.id);

    # 2Ô∏è‚É£ Obtener ID de la columna "Todo"
    - name: Get column ID
      id: get_column
      uses: actions/github-script@0.8.0
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const columnName = 'Todo';
          const projectId = ${{ steps.get_project.outputs.project_id }};

          const columns = await github.projects.listColumns({
            project_id: projectId
          });

          const column = columns.data.find(c => c.name === columnName);
          if (!column) {
            throw new Error(`Columna "${columnName}" no encontrada`);
          }

          core.setOutput('column_id', column.id);

    # 3Ô∏è‚É£ Crear la card en la columna
    - name: Create project card
      if: contains(github.event.issue.labels.*.name, 'bug')
      uses: actions/github-script@0.8.0
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const columnId = ${{ steps.get_column.outputs.column_id }};

          await github.projects.createCard({
            column_id: columnId,
            content_id: context.payload.issue.id,
            content_type: 'Issue'
          });

          console.log('Card creada correctamente');
